<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> HBase表结构设计笔记 · Edagarli's Blog</title><meta name="description" content="HBase表结构设计笔记 - Edagarli"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/edagarli" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/edagarli" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://t.cn/RqJwVLs" target="_blank" class="nav-list-link">经历</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">HBase表结构设计笔记</h1><div class="post-time">2016年2月6日</div><div class="post-content"><p>在设计HBase表时，Rowkey设计是很重要的事情，应该基于预期的访问模式来为Rowkey建模。</p>
<p>Rowkey非常重要，在设计时需要慎重考虑。以存储用户观影记录数据为例，复合的Rowkey由用户ID作为前缀(方便把某用户的观影记录聚合在一起)，倒置的时间串作为Rowkey的后缀可以使观影记录数据从新到旧排列。如果Rowkey是整型的，用二进制的方式应该比用String来存储一个数据更节约空间。</p>
<a id="more"></a>
<p>Rowkey进行设计需要的注意要点。</p>
<p>1.Rowkey是以字典顺序从大到小排序。<br>2.Rowkey尽量散列Rowkey设计。<br>最重要的是要保证散列，这样就会保证所有的数据都不是在一个Region上，从而避免读写的时候负载会集中在个别Region上。从而避免读写的时候负载会集中在个别Region上。</p>
<p>假设我们需要存储一个视频网站用户的所有观影记录（暂时不需要考虑时间倒排），这时候的Rowkey可设计为userid_videoid的拼接字符串，但是这样设计的话，userid的分布就很可能不均匀，因此Rowkey是按字符串排序的（默认字典顺序排序）。</p>
<p>有3种办法来解决这个问题，具体如下：</p>
<p>一.反转userid，将userid字符串反转后存储。</p>
<p>二.散列userid,即对userid进行散列。</p>
<p>三.userid取模后进行MD5加密，取前6位作为前缀加入到userid前面。</p>
<p>假设某视频网站的用户正在观看视频，但此时，要开辟一个新栏目，所有的用户观影记录都按照时间倒排序展示在这个栏目中。这个时候，就需要为原来的userid_vedioid建立一张索引表，并且这个表的Rowkey要和时间相关。</p>
<p>Rowkey设计可以使用当前时间（观影时间）的Long值作为Rowkey的前缀。另外建议Rowkey最好都是String：一是方便线上使用Shell查数据，排查错误；二是更容易让数据均匀分布；三是不必考虑存储成本。</p>
<p>3.Rowkey的长度尽量短。<br>如果Rowkey太长，第一存储开销会增加，影响存储效率；第二内存中Rowkey字段过长，会导致内存的利用率降低，进而降低索引命中率。<br>一般的做法是：</p>
<p>时间使用Long来表示。<br>尽量使用编码压缩。</p>
<p>如果觉得还不错，赏点酒钱！<br><img src="/images/aex068188cqwy9xbxa3oc07.png" alt=""></p>
<hr>
<p>读书笔记来自 &lt; HBase企业开发实战 &gt; 一书</p>
<p>更多书籍读书笔记请参看</p>
<p><a href="https://github.com/edagarli/ReadingNotes" target="_blank" rel="external">https://github.com/edagarli/ReadingNotes</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/02/09/创业反思/" class="prev">上一篇</a><a href="/2016/02/05/情人节礼物/" class="next">下一篇</a></div><div data-thread-key="2016/02/06/HBase表结构设计笔记/" data-title="HBase表结构设计笔记" data-url="http://blog.edagarli.com/2016/02/06/HBase表结构设计笔记/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"edagarli"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.edagarli.com">Edagarli</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src ="//hm.baidu.com/hm.js?47be17dedd3258963b6518c2ffbd5e1d";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>